<body>
<link href="https://fonts.googleapis.com/css?family=Antic+Slab" rel="stylesheet">
<style>
*,
*:before,
*:after {
  box-sizing: inherit;
}
body {
  font-family: 'Antic Slab', serif;
}

</style>
<script src="https://unpkg.com/react@16.0.0/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@16.0.0/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/prop-types@15.6.0/prop-types.js"></script>
<script src="https://unpkg.com/babel-standalone@6.26.0/babel.js"></script>

<div id="⚛️"></div>

<script type="text/babel">

class Pager extends React.Component {
  static defaultProps = {
    items: [],
    itemsPerPage: 5,
    defaultCurrentPage: 1,
    maxPagesInPageNav: 3,
    onSetCurrentPage: () => {}
  };

  initialState = {currentPage: this.props.defaultCurrentPage};
  state = this.initialState;

  setCurrentPage = (page) => {
    if (!this.isCurrentPageControlled()) {
      this.setState({currentPage: page}, this.props.onSetCurrentPage);
    }
  }

  isCurrentPageControlled() {
    return this.props.currentPage !== undefined;
  }

  static getPages = (totalPages, currentPage, maxPages) => {
    const allPages = Array.from({length: totalPages}, (_, i) => i + 1);

    if (totalPages <= maxPages) {
      return allPages;
    }

    let result;

    // if currentPage is within maxPages of the first page
    if (currentPage <= maxPages) {
      result = [...allPages.slice(0, maxPages), '...'];
    }
    // if currentPage is within maxPages of the last page
    else if (currentPage > totalPages - maxPages) {
      result = ['...', ...allPages.slice(-maxPages)];
    }
    else {
      let startOffset;
      const remainder = currentPage % maxPages;

      if (remainder === 1) {
        startOffset = 0;
      }
      else if (remainder === 0) {
        startOffset = maxPages - 1;
      }
      else {
        startOffset = remainder - 1;
      }

      const menuPagesStart = currentPage - 1 - startOffset;
      const menuPagesEnd = menuPagesStart + maxPages;

      result = [
        '...',
        ...allPages.slice(menuPagesStart, menuPagesEnd),
        '...'
      ];
    }
    return result;
  }

  getPagerProps = () => {
    const { render, ...props } = this.props;
    const { items, itemsPerPage, maxPagesInPageNav } = props;

    const currentPage = this.isCurrentPageControlled()
      ? this.props.currentPage
      : this.state.currentPage;

    if (!items.length) {
      return {
        items: [],
        pages: [],
        previous: false,
        next: false,
        currentPage
      }
    }

    const start = (currentPage - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    const _items = items.slice(start, end);
    const totalPages = Math.ceil(items.length / itemsPerPage);
    const previous = currentPage !== 1 ? currentPage - 1 : false;
    const next = currentPage < totalPages ? currentPage + 1 : false;
    const pages = Pager.getPages(totalPages, currentPage, maxPagesInPageNav);

    return {
      items: _items,
      currentPage: currentPage,
      totalPages: totalPages,
      pages: pages,
      previous: previous,
      next: next
    }

  }
  render() {
    return this.props.render({
      ...this.getPagerProps(),
      setCurrentPage: this.setCurrentPage
    })
  }
}

class PagerProvider extends React.Component {
  static contextName = '__pager__'
  static Renderer = class extends React.Component {
    static childContextTypes = {
      [PagerProvider.contextName]:
        PropTypes.object.isRequired,
    }
    getChildContext() {
      return {
        [PagerProvider.contextName]: this.props
          .pager,
      }
    }
    render() {
      return this.props.children
    }
  }
  render() {
    const {
      children,
      ...remainingProps
    } = this.props
    return (
      <Pager
        {...remainingProps}
        render={pager => (
          <PagerProvider.Renderer
            pager={pager}
            children={children}
          />
        )}
      />
    )
  }
}

function ConnectedPager(props, context) {
  return props.render(
    context[PagerProvider.contextName],
  )
}
ConnectedPager.contextTypes = {
  [PagerProvider.contextName]:
    PropTypes.object.isRequired,
}

function BlogNav({setPage}) {
  return (
    <ConnectedPager
      render={pager => {
        const { pages, previous, next, totalPages } = pager;
        return (
          <div>
            {previous &&
              <span
                style={{marginRight: 10}}
                onClick={() => { setPage(previous) }}>
                «
              </span>
            }
            {pages.map((page, index) => {
              const newPage = page === '...'
                ? index
                   ? totalPages
                   : 1
                : page;
              return (
                <span
                  key={index}
                  style={{marginRight: 10}}
                  onClick={() => { setPage(newPage) }}>
                  {page}
                </span>
              )
            })}
            {next &&
              <span
                onClick={() => { setPage(next) }}>
                »
              </span>
            }
          </div>
        )
      }}
    />
  )
}

function CurrentPageDisplay() {
  return (
    <ConnectedPager
      render={pager => {
        return (
          <div>
            Page {pager.currentPage} of {pager.totalPages}
          </div>
        )
      }}
    />
  );
}

function Header({setPage}) {
  return (
    <header>
      <h1>Blog</h1>
      <CurrentPageDisplay />
    </header>
  );
}

function BlogContent() {
  return (
    <ConnectedPager
      render={pager => {
        console.log('BlogContent', {pager});
        return (
          <div>
            {pager.items.map((item, index) => {
              return (
                <h3 key={index}>
                  {item.title}
                </h3>
              )
            })}
          </div>
        )
      }}
    />
  );
}

function PageBody({setPage}) {
  return (
    <div>
      <BlogContent />
      <BlogNav setPage={setPage} />
    </div>
  );
}

const posts = Array.from({length: 50}, (_, i) => {
  return {
    title: `Post #${i + 1}`
  }
})

class Blog extends React.Component {
  static defaultProps = {
    defaultPage: 1,
    defaultPosts: posts
  };
  initialState = {
    currentPage: this.props.defaultPage,
    posts: this.props.defaultPosts
  };
  state = this.initialState;

  setPage = (page) => {
    this.setState({currentPage: page});
  }

  render() {
    return (
      <PagerProvider
        items={this.state.posts}
        itemsPerPage={5}
        currentPage={this.state.currentPage}
        maxPagesInPageNav={3}
      >
        <Header />
        <PageBody setPage={this.setPage} />
      </PagerProvider>
    )
  }
}

ReactDOM.render(
  <Blog />,
  document.getElementById('⚛️'),
)
</script>
</body>
